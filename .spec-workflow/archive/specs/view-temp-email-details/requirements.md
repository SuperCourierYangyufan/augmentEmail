# 临时邮箱-查看邮件详情 功能需求（分页修订）

## 背景与现状
- 现有页面 `src/main/resources/static/temp-email-manager.html` 与 `temp-email-manager.js` 已具备：生成临时邮箱、获取验证码/验证链接、删除全部邮件、封禁等功能。
- 需要在“查看邮件”中仅展示三项核心内容：发送人、发送时间、完整邮件内容，并且支持刷新；页面风格需与现有保持一致。

## 目标（Must）
- 前端：在每个临时邮箱卡片新增“查看邮件”按钮；打开模态框展示该邮箱“所有邮件”的分页列表，每条显示：
  - 发送人（发件人显示名或邮箱地址）
  - 发送时间（yyyy-MM-dd HH:mm:ss）
  - 完整邮件内容（支持 HTML 渲染，无法解析时回退为纯文本）
  提供分页控件（上一页/下一页/页码）与“刷新”按钮，风格与现有页面一致。
- 后端：提供只读接口用于获取“指定临时邮箱所有邮件”的分页数据；返回稳定结构，字段包含上述三项核心字段与分页元信息。
- 鉴权：无需新增鉴权逻辑，沿用现有拦截器/会话机制。

## 非目标（Won't）
- 不展示临时邮箱基础元信息（如状态、创建时间、是否过期等）。
- 不展示操作日志（EmailLog）与统计信息。
- 不处理附件解析与展示（可作为后续扩展）。
- 不新增外部前端框架或全局样式体系。

## 术语
- 临时邮箱：`TempEmail` 记录，仅作为定位邮箱地址使用。
- 邮件内容：IMAP 收件信息中的“发送人、发送时间、正文内容”。

## 用户故事（EARS）
- 当我在临时邮箱列表中点击“查看邮件”时，我希望分页浏览该邮箱“所有邮件”的发送人、发送时间与完整内容，并可点击“刷新”获取更新，以便逐一查看。

## 主要场景与验收标准
1) 查看分页邮件
- 列表项出现“查看邮件”按钮。
- 点击后弹出模态框，首次加载显示加载态，成功后展示邮件列表（每条显示发送人/发送时间/完整内容）。
- 提供分页控件与当前页高亮；切换页码时仅更新模态内的列表与分页，不关闭模态。
- 若不存在任何邮件，显示空态文案与提示（不报错）。

2) 刷新
- 模态框内提供“刷新”按钮；点击后重新请求当前页数据并更新展示，模态保持打开状态。

3) 错误处理
- 鉴权由既有机制处理（本功能不新增鉴权）；未登录等场景按既有全局逻辑跳转或提示。
- 邮箱不存在或格式不正确：前端以错误提示告知；接口返回与现有风格一致的 `success/message` 结构或合适的 HTTP 状态。

## 约束与兼容
- 风格一致：复用现有模态与通知样式，保持圆角、阴影、色彩体系一致。
- 安全：前端渲染 HTML 时避免脚本执行（基本的 XSS 防护/白名单过滤），不返回/存储 `authKey`。
- 性能：只读查询，目标接口处理耗时 < 200ms（不含网络）。

## 数据模型/实体调整
- 定义邮件内容视图实体（DTO），用于前后端交互：
  - `sender`：string，发件人显示名或邮箱地址
  - `sentTime`：string，格式 `yyyy-MM-dd HH:mm:ss`
  - `content`：string，完整正文内容（HTML 或纯文本）
- 分页返回结构：
  - `content`: EmailContentDto[]
  - `totalElements`: number
  - `totalPages`: number
  - `number`: number（0 基，前端自行 +1 展示）
  - `size`: number
  - `first`/`last`: boolean

## 接口约定
- Method: GET
- Path: `/api/temp-email/emails`
- Query: `emailAddress`（必填）、`page`（默认1）、`size`（默认5）
- 返回（成功示例）：
```
{
  "success": true,
  "data": {
    "content": [
      { "sender": "Example Sender <sender@example.com>", "sentTime": "2025-08-08 12:34:56", "content": "<html>..." },
      { ... }
    ],
    "totalElements": 23,
    "totalPages": 5,
    "number": 0,
    "size": 5,
    "first": true,
    "last": false
  },
  "message": "查询成功"
}
```
- 未找到邮件：`content=[], totalElements=0, totalPages=0`。

## 交付清单
- GET `/api/temp-email/email-content?emailAddress=...` 后端接口与最小自测。
- 前端新增“查看邮件”模态与渲染、刷新逻辑（HTML/JS）。
